<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Backup LXC containers â€” iaroki blog</title>
	<meta name="description" content="Title: Backup LXC containers; Date: 2016-10-20; Author: iaroki">
	<meta name="author" content="iaroki">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="/theme/html5.js"></script>
		<![endif]-->
	<link href="/theme/css/ipython.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="/theme/css/local.css" rel="stylesheet">
	<link href="/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<div class="page-header">
		<h1><a href="/">iaroki blog</a>
			<br>	</div>
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Backup LXC containers</h1>
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<h4 itemprop="name">iaroki</h4>
		</span>
		<time datetime="2016-10-20T13:44:00+03:00" itemprop="datePublished">Thu 20 October 2016</time>
	</div>
	<div>
		Category:
		<span itemprop="articleSection">
			<a href="/category/linux.html" rel="category">Linux</a>
		</span>
	</div>
 
	<div>
		Tags:
		<span itemprop="keywords">
			<a href="/tag/linux.html" rel="tag">linux</a>
		</span>
		<span itemprop="keywords">
			<a href="/tag/lxc.html" rel="tag">lxc</a>
		</span>
		<span itemprop="keywords">
			<a href="/tag/containers.html" rel="tag">containers</a>
		</span>
		<span itemprop="keywords">
			<a href="/tag/backup.html" rel="tag">backup</a>
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><h2>Moving LXC containers between host systems</h2>
<p>This is how migrate LXC containers between systems:
* Shutdown the container</p>
<div class="highlight"><pre><span></span># lxc-stop -n $NAME
</pre></div>


<ul>
<li>Archive container rootfs &amp; config</li>
</ul>
<div class="highlight"><pre><span></span># cd /var/lib/lxc/$NAME/
# tar --numeric-owner -czvf container_fs.tar.gz ./*
</pre></div>


<p>The <code>--numeric-owner</code> flag is very important! Without it, the container may not boot because the <code>uid/gids</code> get mangled in the extracted filesystem. When tar creates an archive, it preserves user / group ownership information. By default, when extracting, tar tries to resolve the archive user/group ownership names with the ids on the system running tar. This is intended to ensure that user ownership is resolved on the new system, in case the UID numeric values differ between systems.</p>
<p>This is bad for an LXC filesystem because the numeric uid/gid ownership is intended to be preserved for the whole filesystem. If it gets resolved to a different value, bad things happen.</p>
<ul>
<li>Copy the file to your new server</li>
</ul>
<div class="highlight"><pre><span></span># rsync -avh container_fs.tar.gz user@newserver:/var/lib/lxc/
</pre></div>


<ul>
<li>Extract rootfs</li>
</ul>
<div class="highlight"><pre><span></span># mkdir /var/lib/lxc/$NAME/
# cd /var/lib/lxc/$NAME/
# tar --numeric-owner -xzvf container_fs.tar.gz ./*
</pre></div></div>
	<hr>
	<h2>Comments</h2>
</div>
		</div>
	</div> 	<!-- <hr> -->
</div> <!-- /container -->
<footer class="aw-footer bg-danger">
	<div class="container"> <!-- footer -->
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-3">
						<h4>Navigation</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="">iaroki blog</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Author</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://github.com">Github</a></li>
							<li><a href="https://facebook.com">Facebook</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Categories</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="/category/docker.html">Docker (3)</a></li>
							<li><a href="/category/git.html">Git (2)</a></li>
							<li><a href="/category/linux.html">Linux (23)</a></li>
							<li><a href="/category/markdown.html">Markdown (2)</a></li>
							<li><a href="/category/other.html">Other (1)</a></li>
							<li><a href="/category/python.html">Python (1)</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Links</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="http://getpelican.com/">Pelican</a></li>
							<li><a href="http://python.org/">Python.org</a></li>
							<li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; iaroki 2016</p>
			<p>Powered by Pelican</p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
</body>
</html>